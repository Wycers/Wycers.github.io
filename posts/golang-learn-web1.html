<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web 学习（1）——标准库 http 实现 server · Wycer&#39;s blog · QwQ</title>
    <meta name="description" content="花开花落，再灿烂的星光也会消失。">
    <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3F51B5">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/192.png">
  <meta name="msapplication-TileImage" content="/icons/192.png">
  <meta name="msapplication-TileColor" content="#3F51B5">
    
    <link rel="preload" href="/assets/css/styles.b0d9375f.css" as="style"><link rel="preload" href="/assets/js/app.b0d9375f.js" as="script"><link rel="preload" href="/assets/js/41.c41458bd.js" as="script"><link rel="prefetch" href="/assets/js/1.9bac55ce.js"><link rel="prefetch" href="/assets/js/10.0fccaf93.js"><link rel="prefetch" href="/assets/js/11.8285e651.js"><link rel="prefetch" href="/assets/js/12.204817fe.js"><link rel="prefetch" href="/assets/js/13.38904b1e.js"><link rel="prefetch" href="/assets/js/14.d3875814.js"><link rel="prefetch" href="/assets/js/15.f0c91af7.js"><link rel="prefetch" href="/assets/js/16.a2b839b2.js"><link rel="prefetch" href="/assets/js/17.bb852593.js"><link rel="prefetch" href="/assets/js/18.0d9a8cc4.js"><link rel="prefetch" href="/assets/js/19.5e0e13b5.js"><link rel="prefetch" href="/assets/js/2.c118dce5.js"><link rel="prefetch" href="/assets/js/20.b58f8628.js"><link rel="prefetch" href="/assets/js/21.c7367110.js"><link rel="prefetch" href="/assets/js/22.34c06b15.js"><link rel="prefetch" href="/assets/js/23.97b66e2d.js"><link rel="prefetch" href="/assets/js/24.3395d0f0.js"><link rel="prefetch" href="/assets/js/25.fb38d25e.js"><link rel="prefetch" href="/assets/js/26.c8f77286.js"><link rel="prefetch" href="/assets/js/27.fb43c517.js"><link rel="prefetch" href="/assets/js/28.05e657f1.js"><link rel="prefetch" href="/assets/js/29.bd82caad.js"><link rel="prefetch" href="/assets/js/3.0fc009c0.js"><link rel="prefetch" href="/assets/js/30.e7a91386.js"><link rel="prefetch" href="/assets/js/31.1fb824c7.js"><link rel="prefetch" href="/assets/js/32.0c2c5b81.js"><link rel="prefetch" href="/assets/js/33.d9f45cca.js"><link rel="prefetch" href="/assets/js/34.8b1a1b90.js"><link rel="prefetch" href="/assets/js/35.bfb8a69d.js"><link rel="prefetch" href="/assets/js/36.893001da.js"><link rel="prefetch" href="/assets/js/37.5d5d1fbd.js"><link rel="prefetch" href="/assets/js/38.7bedce41.js"><link rel="prefetch" href="/assets/js/39.67872723.js"><link rel="prefetch" href="/assets/js/4.e2663d4d.js"><link rel="prefetch" href="/assets/js/40.9b034a87.js"><link rel="prefetch" href="/assets/js/42.19c99a73.js"><link rel="prefetch" href="/assets/js/43.3e7e0230.js"><link rel="prefetch" href="/assets/js/44.f6ac2b06.js"><link rel="prefetch" href="/assets/js/45.b8b598ed.js"><link rel="prefetch" href="/assets/js/46.48b16736.js"><link rel="prefetch" href="/assets/js/47.11c3adfa.js"><link rel="prefetch" href="/assets/js/48.3563729a.js"><link rel="prefetch" href="/assets/js/49.6cea32d4.js"><link rel="prefetch" href="/assets/js/5.9c36dcff.js"><link rel="prefetch" href="/assets/js/50.b72bf221.js"><link rel="prefetch" href="/assets/js/51.8be703c0.js"><link rel="prefetch" href="/assets/js/52.4b0ad7a8.js"><link rel="prefetch" href="/assets/js/53.551ce7fb.js"><link rel="prefetch" href="/assets/js/54.f96082ce.js"><link rel="prefetch" href="/assets/js/6.14292550.js"><link rel="prefetch" href="/assets/js/7.710cec77.js"><link rel="prefetch" href="/assets/js/8.eba8f4c4.js"><link rel="prefetch" href="/assets/js/9.0cc7f4d1.js">
    <link rel="stylesheet" href="/assets/css/styles.b0d9375f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="application theme--light"><div class="application--wrap"><div class="progress-linear blog-progress" style="height:3px;display:none;"><div class="progress-linear__background accent" style="height:3px;opacity:0.4;width:100%;"></div><div class="progress-linear__bar"><!----><div class="progress-linear__bar__determinate accent" style="width:0%;"></div></div></div><aside class="navigation-drawer navigation-drawer--close navigation-drawer--fixed navigation-drawer--is-mobile" style="height:100%;margin-top:0px;max-height:calc(100% - 0px);transform:translateX(-240px);width:240px;"><div><div class="aside-brand-wrap"><div class="aside-brand elevation-1"><a href="/" class="aside-avatar elevation-2 router-link-active"><img src="/avatar.jpg" alt="avatar"></a><hgroup class="mt-3 variant-hide aside-group white--text"><div class="headline">Wycer</div><a title="wycers@gmail.com" class="aside-mail white--text">wycers@gmail.com</a><p class="subheading mt-1 aside-description">花开花落，再灿烂的星光也会消失。</p></hgroup></div></div><hr class="divider theme--dark"><div class="list nav-list"><div class="secondary--text"><a href="/" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-home"></i></div></div><div class="list__tile__content">主页</div></a></div><div class="secondary--text"><a href="/essay" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-edit"></i></div></div><div class="list__tile__content">随笔</div></a></div><div class="secondary--text"><a href="/tags" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-tag"></i></div></div><div class="list__tile__content">标签</div></a></div><div class="secondary--text"><a href="/github" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fab fa-github"></i></div></div><div class="list__tile__content">Github</div></a></div><div class="secondary--text"><a href="/about" class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-user-secret"></i></div></div><div class="list__tile__content">关于</div></a></div></div></div><div class="navigation-drawer__border"></div></aside><nav class="blog-toolbar toolbar toolbar--fixed theme--dark primary" style="margin-top:0px;padding-right:0px;padding-left:0px;transform:translateY(0px);"><div class="toolbar__content" style="height:56px;"><button type="button" class="btn btn--icon"><div class="btn__content"><i class="fa fa-bars"></i></div></button><div class="toolbar__title">Web 学习（1）——标准库 http 实现 server</div><div class="spacer"></div><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><div class="menu" style="display:none;"><div class="menu__activator"><button type="button" class="btn btn--icon"><div class="btn__content"><i class="fa fa-share-alt"></i></div></button></div><div class="menu__content" style="max-height:auto;min-width:0px;max-width:auto;top:12px;left:0px;transform-origin:top right;z-index:0;display:none;"><div class="list"><div class="secondary--text"><a class="list__tile list__tile--link"><div class="list__tile__avatar"><div class="avatar" style="height:40px;width:40px;"><i class="fa fa-lg fa-copy"></i></div></div><div class="list__tile__title">复制链接</div></a></div></div><input type="text" tabindex="-1" aria-hidden="true" value="" class="fake-hide"></div></div></div></nav><main class="content" style="padding-top:56px;padding-right:0px;padding-bottom:0px;padding-left:0px;"><div class="content--wrap"><div class="container blog-container grid-list-xl align-center"><div class="layout row wrap"><div class="flex mb-3 xs12"><article class="card elevation-16 post-card" style="height:auto;"><div class="card__title"><div class="flex xs12"><h2 class="display-1 mb-3">Web 学习（1）——标准库 http 实现 server</h2><div class="post-meta"><time datetime="2018-04-29T12:15:53.000Z" class="secondary--text post-time">2018年04月29日</time></div></div></div><div class="card__text pt-0 pb-0"><div class="flex xs12"><div class="content custom"><p>使用 go 语言的 http 标准库学习 web</p><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2><p>最近放假在家好好学习了一下 Go 语言，Go 作为 Google 官推的 Server 语言，因为天生的并发性和完备的标准库让 Go 语言在服务端如鱼得水。笔者在简单的学习了之后，真的是惊讶连连，好了进入正题。</p><p>首先，我们必须实现一个 Go Web 版的 Hello World。</p><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8000&quot;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>我们可以看到 Go 语言实现一个 Web HelloWorld 的简洁程度甚至直接媲美 Node.js，不需要任何容器便可以实现一个高并发的简单服务器。下面我们来分析一下这个代码：</p><p>首先，我们导入了 fmt,http 包，log 包其实对于 HelloWorld 来说并没有导入的必要，但是日志输出这个良好习惯还是得遵从。在 main()函数的第一行，我们通过 http.HandleFunc 定义了路由为&quot;/&quot;的响应函数，这个响应函数，接受传来的 Request，并对 Response 做一定的处理即写入 HelloWorld 然后直接返回给浏览器。然后便可以直接调用 http.ListenAndServe 来监听本地的 8000 端口，便可以直接在浏览器上看到 HelloWorld。</p><p>好，上面的流程其实很简单，有一定 Web 编程的人便都能明白，接下来我们便从 Go 的源码中看一看，这段代码究竟是如何实现的。</p><pre class="language-go"><code><span class="token comment">// HandleFunc registers the handler function for the given pattern</span>
<span class="token comment">// in the DefaultServeMux.</span>
<span class="token comment">// The documentation for ServeMux explains how patterns are matched.</span>
<span class="token keyword">func</span> <span class="token function">HandleFunc</span><span class="token punctuation">(</span>pattern <span class="token builtin">string</span><span class="token punctuation">,</span> handler <span class="token keyword">func</span><span class="token punctuation">(</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>Request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	DefaultServeMux<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>上面这段便是 Go 源码中对 HandleFunc 函数的实现，我们可以看到这个函数直接将所有参数全部传递给了 DefaultServeMux.HandleFunc 来调用。</p><pre class="language-go"><code><span class="token comment">// DefaultServeMux is the default ServeMux used by Serve.</span>
<span class="token keyword">var</span> DefaultServeMux <span class="token operator">=</span> <span class="token operator">&amp;</span>defaultServeMux

<span class="token keyword">var</span> defaultServeMux ServeMux
</code></pre><p>DefaultServeMux 是 http 包中的全局变量，它的原型是 ServeMux 这个结构体，我们再往上翻看这个结构体的 HandleFunc 方法。</p><pre class="language-go"><code><span class="token comment">// HandleFunc registers the handler function for the given pattern.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>mux <span class="token operator">*</span>ServeMux<span class="token punctuation">)</span> <span class="token function">HandleFunc</span><span class="token punctuation">(</span>pattern <span class="token builtin">string</span><span class="token punctuation">,</span> handler <span class="token keyword">func</span><span class="token punctuation">(</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>Request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token function">HandlerFunc</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>我们可以看到，似乎没完没了，HandleFunc 也是直接调用这个结构体的另一个方法 Handle，另外 HandlerFunc(handler)中的 HandlerFunc 也只是一个 type 的定义。</p><pre class="language-go"><code><span class="token keyword">type</span> HandlerFunc <span class="token keyword">func</span><span class="token punctuation">(</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>Request<span class="token punctuation">)</span>
</code></pre><p>这个函数本身并没有实现什么，需要我们自己去实现它的内容。也就是我们上面所提到的响应函数。</p><pre class="language-go"><code><span class="token comment">// Handle registers the handler for the given pattern.</span>
<span class="token comment">// If a handler already exists for pattern, Handle panics.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>mux <span class="token operator">*</span>ServeMux<span class="token punctuation">)</span> <span class="token function">Handle</span><span class="token punctuation">(</span>pattern <span class="token builtin">string</span><span class="token punctuation">,</span> handler Handler<span class="token punctuation">)</span>
</code></pre><p>终于我们找到了源头，当然这个方法的源代码还比较长，这里就不贴出全部，Handle 这个方法接受两个参数，pattern 这个 string 类型的参数表示路由，第二个参数 handle 它其实是 Handler 接口。</p><pre class="language-go"><code><span class="token keyword">type</span> Handler <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token function">ServeHTTP</span><span class="token punctuation">(</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>Request<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>可以看到 Handler 这个接口中只定义了 ServeHTTP 这一个方法，换句话说，我们也可以直接实现 ServeHTTP 这个方法来实现 Handler 这个接口，然后我们便可以传给 ServeMux 来自定义我们的 HelloWorld.</p><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> CustomHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>CustomHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mux <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewServeMux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	mux<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>CustomHandler<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8000&quot;</span><span class="token punctuation">,</span> mux<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>上面的代码可以看到，我们定义了一个 CustomHandler,然后实现了 ServeHTTP 这个方法从而实现了 Handler 这个接口，在 main 方法中，我们通过 NewServeMux 创建了一个自己的 mux 而不去使用 http 内的默认 ServerMux。然后调用 ListenAndServe 方法，并将自己的 mux 传入，程序便会实现自定义的 HelloWorld 了。接下来我们来看一下 ListenAndServe 这个方法：</p><pre class="language-go"><code><span class="token comment">// ListenAndServe always returns a non-nil error.</span>
<span class="token keyword">func</span> <span class="token function">ListenAndServe</span><span class="token punctuation">(</span>addr <span class="token builtin">string</span><span class="token punctuation">,</span> handler Handler<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	server <span class="token operator">:=</span> <span class="token operator">&amp;</span>Server<span class="token punctuation">{</span>Addr<span class="token punctuation">:</span> addr<span class="token punctuation">,</span> Handler<span class="token punctuation">:</span> handler<span class="token punctuation">}</span>
	<span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>源码中可以看到该方法会将传入进来的 addr 参数和 handler 送给 Server 这个结构体，从而新建一个 server 然后调用这个 server 的 ListenAndServe 方法，对于 Server 这个结构它已经是 Go 语言对于这个方面非常底层的实现了，它非常强大，而且实现了很多的方法，这里不过多阐述，主要是实力不够（笑）。好，回到正题，既然如此，我们便可以自己创建 Server 这个实例，来自定义我们的 HelloWorld 的第二版本。</p><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;net/http&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> CustomHandler <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> mux <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">*</span>CustomHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> handler<span class="token punctuation">,</span> ok <span class="token operator">:=</span> mux<span class="token punctuation">[</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
		<span class="token function">handler</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	server <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
		Addr<span class="token punctuation">:</span><span class="token string">&quot;:8000&quot;</span><span class="token punctuation">,</span>
		Handler<span class="token punctuation">:</span><span class="token operator">&amp;</span>CustomHandler<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		ReadHeaderTimeout<span class="token punctuation">:</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	mux<span class="token punctuation">[</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> Hello
	err <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>上面这段代码便是自创 server 的实现了，这里挑选几条新的代码说明一下，我们定义了一个 mux 的全局变量，它来装配我们的路由与相应函数的映射，相当于上面的 mux.Handle(&quot;/&quot;, .....)，这里比较简陋的直接用 Map 来实现，接下来我们定义了 Hello 这个响应函数，我们也重写了 ServeHTTP 这个方法，它会判断 request 的 url 路径与我们 mux 里面的路径是否匹配，如果匹配在从 mux 中取出相应的响应函数并将 w http.ResponseWriter, r *http.Request 这两个参数传递给这个相应函数。</p><p>在 main 函数里，我们创建了自己的 server，通过端口号，Handler 及 timeout 时间来定义它，然后调用它的 ListenAndServe 方法，便可以实现与前面两个相同的 HelloWorld 功能。好了，今天写到这里，太晚了（笑）。</p></div></div></div><div class="card__actions"><div class="flex xs12"><a href="/tags/golang"><span tabindex="0" class="chip capitalize chip-tag chip--label chip--small"><span class="chip__content">golang</span></span></a><a href="/tags/web"><span tabindex="0" class="chip capitalize chip-tag chip--label chip--small"><span class="chip__content">web</span></span></a></div></div></article></div><div class="flex text-xs-left xs6"><a href="/posts/golang-learn-standard.html" class="post-nav btn btn--flat btn--router"><div class="btn__content"><div class="grey--text"><i class="fa mr-1 fa-chevron-left"></i>Prev</div><div class="title mt-1 primary--text hidden-xs-only">Go 语言学习（1）——标准库 fmt</div></div></a></div><div class="flex text-xs-right xs6"><a href="/posts/golang-learn-web2.html" class="post-nav btn btn--flat btn--router"><div class="btn__content"><div class="grey--text">Next
          <i class="fa ml-1 fa-chevron-right"></i></div><div class="title mt-1 primary--text hidden-xs-only">Web 学习（2）——实现中间件(middleware)</div></div></a></div><div class="flex mt-3 xs12"><div class="card" style="height:auto;"><div class="card__title"><span class="headline">评论区</span></div><div class="container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i><p class="gt-initing-text">Gitalking ...</p></div><!----><!----><div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span><!----></span></a><div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea><div class="gt-header-preview markdown-body hide"></div><div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span><span class="gt-ico-text">Markdown is supported</span></span></a><!----><button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span><!----></button><button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span><!----></button></div></div></div><div class="gt-comments"><span></span><p class="gt-comments-null">
              Be the first guy leaving a comment!
          </p><!----></div></div></div></div></div></div></div><div data-v-44f5dfee><aside class="navigation-drawer navigation-drawer--close navigation-drawer--fixed navigation-drawer--is-mobile navigation-drawer--right" style="height:100%;margin-top:0px;max-height:calc(100% - 0px);transform:translateX(180px);width:180px;" data-v-44f5dfee><div data-v-44f5dfee><p data-v-44f5dfee></p><ul class="group-items" data-v-44f5dfee><li class="sidebar-header" data-v-44f5dfee><a href="#前言" class="sidebar-link" data-v-44f5dfee>
            前言
          </a></li></ul></div><div class="navigation-drawer__border"></div></aside><button type="button" class="mt-5 btn btn--floating btn--fixed btn--right btn--small btn--top theme--dark blue" data-v-44f5dfee><div class="btn__content"><i aria-hidden="true" class="icon fa fa fa fa-list-ul" data-v-44f5dfee></i></div></button></div></div><footer app="" class="footer blog-footer darken-1 mt-3" style="height:auto;"><div class="primary--text text--lighten-4 text-xs-center py-3 card card--flat card--tile primary" style="height:auto;"><div class="card__text pb-0">
      Released under the MIT License
    </div><div class="card__text pt-0 mt-1"><span>Wycer © 2018 - 2024</span><span><a href="https://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer">
            粤ICP备18027145号-1
          </a><br>
        Power by
        <a href="https://vuepress.vuejs.org" target="_blank" rel="noopener noreferrer">VuePress</a> Theme
        <a href="https://github.com/yscoder/vuepress-theme-indigo" target="_blank" rel="noopener noreferrer">indigo</a></span></div></div></footer></div></main><button type="button" class="btn btn--bottom btn--floating btn--fixed btn--right accent" style="display:none;"><div class="btn__content"><i class="fa fa-lg fa-chevron-up"></i></div></button></div></div></div>
    <script src="/assets/js/app.b0d9375f.js" defer></script><script src="/assets/js/41.c41458bd.js" defer></script>
  </body>
</html>
